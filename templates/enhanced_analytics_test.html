<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Analytics Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
</head>
<body>
    <div class="container-fluid p-4">
        <h2>Enhanced Analytics Test Page</h2>
        
        <!-- Test Tabs -->
        <ul class="nav nav-tabs mb-4" id="testTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="basic-tab" data-bs-toggle="tab" data-bs-target="#basic-panel" type="button" role="tab">
                    <i class="bi bi-graph-up"></i> Basic Test
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="enhanced-tab" data-bs-toggle="tab" data-bs-target="#enhanced-panel" type="button" role="tab">
                    <i class="bi bi-cpu"></i> Enhanced Analytics
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="testTabContent">
            <!-- Basic Panel -->
            <div class="tab-pane fade show active" id="basic-panel" role="tabpanel">
                <div class="card">
                    <div class="card-body">
                        <h5>Basic Test Panel</h5>
                        <p>This tab should work normally.</p>
                        <button class="btn btn-primary" onclick="testBasicFunction()">Test Basic Function</button>
                        <div id="basicResult" class="mt-3"></div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Analytics Panel -->
            <div class="tab-pane fade" id="enhanced-panel" role="tabpanel">
                <div class="row">
                    <!-- Gamma Exposure Analysis -->
                    <div class="col-xl-6">
                        <div class="card mb-4">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Gamma Exposure Profile</h5>
                                <button class="btn btn-sm btn-outline-primary" onclick="testGammaChart()">
                                    <i class="bi bi-arrow-clockwise"></i> Test Chart
                                </button>
                            </div>
                            <div class="card-body">
                                <div id="gammaExposureChart" style="height: 300px; border: 1px solid #ddd;"></div>
                                <div class="row mt-3">
                                    <div class="col-4 text-center">
                                        <div class="h6 mb-0" id="totalGammaExposure">₹125.5M</div>
                                        <small class="text-muted">Total Gamma Exposure</small>
                                    </div>
                                    <div class="col-4 text-center">
                                        <div class="h6 mb-0" id="gammaFlipPoint">22000</div>
                                        <small class="text-muted">Gamma Flip Point</small>
                                    </div>
                                    <div class="col-4 text-center">
                                        <div class="h6 mb-0" id="gammaRisk">Medium</div>
                                        <small class="text-muted">Gamma Risk Level</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Volatility Surface -->
                    <div class="col-xl-6">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="mb-0">Volatility Surface Analysis</h5>
                            </div>
                            <div class="card-body">
                                <div id="volatilitySurfaceChart" style="height: 300px; border: 1px solid #ddd;"></div>
                                <div class="row mt-3">
                                    <div class="col-4 text-center">
                                        <div class="h6 mb-0" id="volSkew">-2.5%</div>
                                        <small class="text-muted">Vol Skew</small>
                                    </div>
                                    <div class="col-4 text-center">
                                        <div class="h6 mb-0" id="termStructure">Contango</div>
                                        <small class="text-muted">Term Structure</small>
                                    </div>
                                    <div class="col-4 text-center">
                                        <div class="h6 mb-0" id="volCluster">High</div>
                                        <small class="text-muted">Vol Clustering</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Test Result Panel -->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Enhanced Analytics Test Results</h5>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-info">
                                    <i class="bi bi-info-circle me-2"></i>
                                    <strong>Test Status:</strong> Enhanced Analytics tab is loading correctly!
                                </div>
                                <button class="btn btn-success" onclick="testAllCharts()">
                                    <i class="bi bi-lightning"></i> Test All Charts
                                </button>
                                <div id="testResults" class="mt-3"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Test functions
        function testBasicFunction() {
            document.getElementById('basicResult').innerHTML = 
                '<div class="alert alert-success">✅ Basic function working!</div>';
        }

        function testGammaChart() {
            // Sample gamma exposure data
            const strikes = [21800, 21900, 22000, 22100, 22200];
            const callGamma = [150, 200, 300, 180, 120];
            const putGamma = [-80, -120, -180, -140, -90];

            const traces = [
                {
                    x: strikes,
                    y: callGamma,
                    type: 'bar',
                    name: 'Call Gamma',
                    marker: { color: 'rgba(52, 168, 83, 0.7)' }
                },
                {
                    x: strikes,
                    y: putGamma,
                    type: 'bar',
                    name: 'Put Gamma',
                    marker: { color: 'rgba(234, 67, 53, 0.7)' }
                }
            ];

            const layout = {
                title: 'Test Gamma Exposure Chart',
                xaxis: { title: 'Strike Price' },
                yaxis: { title: 'Gamma Exposure' },
                barmode: 'group',
                margin: { t: 40, r: 20, b: 40, l: 60 },
                paper_bgcolor: 'transparent',
                plot_bgcolor: 'transparent'
            };

            Plotly.react('gammaExposureChart', traces, layout);
        }

        function testVolChart() {
            // Sample volatility data
            const strikes = [21800, 21900, 22000, 22100, 22200];
            const callIV = [18.5, 17.2, 16.0, 16.8, 18.1];
            const putIV = [19.1, 17.8, 16.5, 17.2, 18.5];

            const traces = [
                {
                    x: strikes,
                    y: callIV,
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: 'Call IV',
                    line: { color: 'rgba(52, 168, 83, 0.8)' }
                },
                {
                    x: strikes,
                    y: putIV,
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: 'Put IV',
                    line: { color: 'rgba(234, 67, 53, 0.8)' }
                }
            ];

            const layout = {
                title: 'Test Volatility Skew',
                xaxis: { title: 'Strike Price' },
                yaxis: { title: 'Implied Volatility (%)' },
                margin: { t: 40, r: 20, b: 40, l: 60 },
                paper_bgcolor: 'transparent',
                plot_bgcolor: 'transparent'
            };

            Plotly.react('volatilitySurfaceChart', traces, layout);
        }

        function testAllCharts() {
            try {
                testGammaChart();
                testVolChart();
                
                document.getElementById('testResults').innerHTML = `
                    <div class="alert alert-success">
                        <h6>✅ All Tests Passed!</h6>
                        <ul class="mb-0">
                            <li>Gamma Exposure Chart: Working</li>
                            <li>Volatility Surface Chart: Working</li>
                            <li>Tab Navigation: Working</li>
                            <li>Plotly Integration: Working</li>
                        </ul>
                    </div>
                `;
            } catch (error) {
                document.getElementById('testResults').innerHTML = `
                    <div class="alert alert-danger">
                        <h6>❌ Error Detected!</h6>
                        <p>Error: ${error.message}</p>
                    </div>
                `;
            }
        }

        // Initialize charts when Enhanced tab is shown
        document.getElementById('enhanced-tab').addEventListener('shown.bs.tab', function() {
            console.log('Enhanced Analytics tab shown - initializing charts...');
            setTimeout(() => {
                testGammaChart();
                testVolChart();
            }, 100);
        });

        // Auto-test on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Test page loaded - Enhanced Analytics diagnostic ready');
        });
    </script>
</body>
</html>
