{% extends "layout.html" %}
{% block title %}Performance Analytics - {{ analyst_name }}{% endblock %}

{% block header %}
<div class="d-flex justify-content-between align-items-center">
    <div>
        <h1 class="mb-0"><i class="bi bi-graph-up-arrow text-primary me-2"></i>Performance Analytics</h1>
        <p class="text-muted mb-0">Comprehensive Performance Analysis for {{ analytics.overview.analyst_name }}</p>
    </div>
    <div>
        <a href="/analyst/certificate_status" class="btn btn-outline-primary me-2">
            <i class="bi bi-arrow-left me-1"></i> Back to Certificates
        </a>
        <button onclick="window.print()" class="btn btn-secondary">
            <i class="bi bi-printer me-1"></i> Print Report
        </button>
    </div>
</div>
{% endblock %}

{% block head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    .analytics-card {
        border: none;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        margin-bottom: 20px;
        transition: transform 0.2s ease-in-out;
    }
    
    .analytics-card:hover {
        transform: translateY(-2px);
    }
    
    .metric-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 15px;
        padding: 20px;
        margin: 10px 0;
    }
    
    .metric-value {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 5px;
    }
    
    .metric-label {
        font-size: 0.9rem;
        opacity: 0.9;
    }
    
    .skill-badge {
        display: inline-block;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        margin: 3px;
    }
    
    .skill-beginner { background: #ffeaa7; color: #2d3436; }
    .skill-intermediate { background: #74b9ff; color: white; }
    .skill-advanced { background: #00b894; color: white; }
    .skill-expert { background: #e84393; color: white; }
    
    .chart-container {
        position: relative;
        height: 350px;
        margin: 20px 0;
    }
    
    .insight-item {
        border-left: 4px solid #667eea;
        padding-left: 15px;
        margin: 15px 0;
        background: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
    }
    
    .recommendation-card {
        border-left: 4px solid #00b894;
        background: #f1f2f6;
        padding: 20px;
        margin: 15px 0;
        border-radius: 8px;
    }
    
    .priority-high { border-left-color: #e74c3c; }
    .priority-medium { border-left-color: #f39c12; }
    .priority-low { border-left-color: #27ae60; }
    
    @media print {
        .btn, .no-print { display: none !important; }
        .analytics-card { box-shadow: none; border: 1px solid #ddd; }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Overview Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="analytics-card">
                <div class="card-header bg-gradient text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <h3 class="mb-0"><i class="bi bi-speedometer2 me-2"></i>Performance Overview</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="metric-card text-center">
                                <div class="metric-value">{{ analytics.overview.overall_score }}%</div>
                                <div class="metric-label">Overall Score</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="metric-card text-center" style="background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);">
                                <div class="metric-value">{{ analytics.overview.completion_rate }}%</div>
                                <div class="metric-label">Completion Rate</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="metric-card text-center" style="background: linear-gradient(135deg, #e84393 0%, #fd79a8 100%);">
                                <div class="metric-value">{{ analytics.overview.completed_skills }}</div>
                                <div class="metric-label">Skills Mastered</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="metric-card text-center" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);">
                                <div class="metric-value">{{ analytics.overview.status }}</div>
                                <div class="metric-label">Performance Level</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <h5><i class="bi bi-calendar-range me-2"></i>Analysis Period</h5>
                            <p class="text-muted">{{ analytics.overview.period_start }} - {{ analytics.overview.period_end }}</p>
                        </div>
                        <div class="col-md-6">
                            <h5><i class="bi bi-person-badge me-2"></i>Analyst Information</h5>
                            <p class="text-muted">{{ analytics.overview.analyst_name }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Performance Trends Chart -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="analytics-card">
                <div class="card-header">
                    <h4 class="mb-0"><i class="bi bi-graph-up me-2"></i>Performance Trend</h4>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="performanceTrendChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="analytics-card">
                <div class="card-header">
                    <h4 class="mb-0"><i class="bi bi-pie-chart me-2"></i>Skill Distribution</h4>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="skillDistributionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Performance Metrics -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="analytics-card">
                <div class="card-header">
                    <h4 class="mb-0"><i class="bi bi-bar-chart me-2"></i>Detailed Performance Metrics</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for metric, value in analytics.performance_metrics.items() %}
                        <div class="col-md-3 mb-3">
                            <div class="text-center">
                                <div class="progress mb-2" style="height: 10px;">
                                    <div class="progress-bar 
                                        {% if value >= 90 %}bg-success
                                        {% elif value >= 80 %}bg-info  
                                        {% elif value >= 70 %}bg-warning
                                        {% else %}bg-danger{% endif %}" 
                                        style="width: {{ value }}%"></div>
                                </div>
                                <h5 class="mb-1">{{ value }}%</h5>
                                <small class="text-muted">{{ metric.replace('_', ' ').title() }}</small>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quality Analysis Chart -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="analytics-card">
                <div class="card-header">
                    <h4 class="mb-0"><i class="bi bi-award me-2"></i>Quality Metrics</h4>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="qualityMetricsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="analytics-card">
                <div class="card-header">
                    <h4 class="mb-0"><i class="bi bi-calendar-week me-2"></i>Weekly Productivity</h4>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="weeklyProductivityChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Skill Assessment -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="analytics-card">
                <div class="card-header">
                    <h4 class="mb-0"><i class="bi bi-list-check me-2"></i>Skill Assessment Matrix</h4>
                </div>
                <div class="card-body">
                    {% for category, skills in analytics.skill_assessment.by_category.items() %}
                    <div class="mb-4">
                        <h5 class="text-primary">{{ category }}</h5>
                        <div class="row">
                            {% for skill in skills %}
                            <div class="col-md-4 mb-2">
                                <div class="d-flex justify-content-between align-items-center p-3 border rounded">
                                    <div>
                                        <strong>{{ skill.name }}</strong>
                                        <br>
                                        <span class="skill-badge skill-{{ skill.proficiency.lower() }}">
                                            {{ skill.proficiency }}
                                        </span>
                                    </div>
                                    <div>
                                        {% if skill.status == 'completed' %}
                                        <i class="bi bi-check-circle-fill text-success fs-4"></i>
                                        {% else %}
                                        <i class="bi bi-clock text-warning fs-4"></i>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- AI Insights -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="analytics-card">
                <div class="card-header">
                    <h4 class="mb-0"><i class="bi bi-lightbulb me-2"></i>AI-Powered Insights</h4>
                </div>
                <div class="card-body">
                    <h6 class="text-success"><i class="bi bi-arrow-up-circle me-1"></i>Key Strengths</h6>
                    {% for strength in analytics.ai_insights.strengths %}
                    <div class="insight-item">
                        <i class="bi bi-check-circle text-success me-2"></i>{{ strength }}
                    </div>
                    {% endfor %}
                    
                    <h6 class="text-warning mt-4"><i class="bi bi-exclamation-triangle me-1"></i>Growth Areas</h6>
                    {% for area in analytics.ai_insights.growth_areas %}
                    <div class="insight-item">
                        <i class="bi bi-arrow-up text-warning me-2"></i>{{ area }}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="analytics-card">
                <div class="card-header">
                    <h4 class="mb-0"><i class="bi bi-graph-down me-2"></i>Performance Patterns</h4>
                </div>
                <div class="card-body">
                    {% for pattern in analytics.ai_insights.patterns %}
                    <div class="insight-item">
                        <i class="bi bi-graph-up text-info me-2"></i>{{ pattern }}
                    </div>
                    {% endfor %}
                    
                    <h6 class="text-primary mt-4"><i class="bi bi-crystal-ball me-1"></i>Future Predictions</h6>
                    {% for prediction in analytics.ai_insights.predictions %}
                    <div class="insight-item">
                        <i class="bi bi-arrow-right text-primary me-2"></i>{{ prediction }}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Recommendations -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="analytics-card">
                <div class="card-header">
                    <h4 class="mb-0"><i class="bi bi-target me-2"></i>Professional Development Recommendations</h4>
                </div>
                <div class="card-body">
                    {% for rec in analytics.recommendations %}
                    <div class="recommendation-card priority-{{ rec.priority.lower() }}">
                        <div class="row">
                            <div class="col-md-8">
                                <h5 class="mb-2">{{ rec.title }}</h5>
                                <p class="text-muted">{{ rec.description }}</p>
                                <small class="text-info"><i class="bi bi-tag me-1"></i>{{ rec.category }}</small>
                            </div>
                            <div class="col-md-4 text-end">
                                <span class="badge bg-{{ 'danger' if rec.priority == 'High' else 'warning' if rec.priority == 'Medium' else 'success' }} fs-6 px-3 py-2">
                                    {{ rec.priority }} Priority
                                </span>
                                <div class="mt-2">
                                    <small class="text-muted">
                                        <i class="bi bi-clock me-1"></i>{{ rec.timeline }}
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Time Analytics -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="analytics-card">
                <div class="card-header">
                    <h4 class="mb-0"><i class="bi bi-clock-history me-2"></i>Time & Productivity Analytics</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="text-center p-3 border rounded">
                                <h4 class="text-primary">{{ analytics.time_analytics.average_task_time }}</h4>
                                <small class="text-muted">Average Task Time</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center p-3 border rounded">
                                <h4 class="text-success">{{ analytics.time_analytics.deadline_adherence }}%</h4>
                                <small class="text-muted">Deadline Adherence</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center p-3 border rounded">
                                <h4 class="text-info">{{ analytics.time_analytics.productivity_index }}</h4>
                                <small class="text-muted">Productivity Index</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center p-3 border rounded">
                                <h4 class="text-warning">{{ analytics.time_analytics.peak_performance_hours }}</h4>
                                <small class="text-muted">Peak Hours</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Chart configuration and data
const chartOptions = {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
        legend: {
            position: 'top',
        }
    }
};

// Performance Trend Chart
const performanceTrendCtx = document.getElementById('performanceTrendChart').getContext('2d');
new Chart(performanceTrendCtx, {
    type: 'line',
    data: {
        labels: {{ analytics.charts_data.performance_trend.labels | tojsonfilter }},
        datasets: [{
            label: 'Performance Score',
            data: {{ analytics.charts_data.performance_trend.data | tojsonfilter }},
            borderColor: 'rgb(102, 126, 234)',
            backgroundColor: 'rgba(102, 126, 234, 0.1)',
            tension: 0.4,
            fill: true
        }]
    },
    options: {
        ...chartOptions,
        scales: {
            y: {
                beginAtZero: true,
                max: 100
            }
        }
    }
});

// Skill Distribution Chart
const skillDistributionCtx = document.getElementById('skillDistributionChart').getContext('2d');
new Chart(skillDistributionCtx, {
    type: 'doughnut',
    data: {
        labels: {{ analytics.charts_data.skill_distribution.labels | tojsonfilter }},
        datasets: [{
            data: {{ analytics.charts_data.skill_distribution.data | tojsonfilter }},
            backgroundColor: [
                '#667eea',
                '#f093fb',
                '#4facfe',
                '#43e97b',
                '#fa709a'
            ]
        }]
    },
    options: chartOptions
});

// Quality Metrics Chart
const qualityMetricsCtx = document.getElementById('qualityMetricsChart').getContext('2d');
new Chart(qualityMetricsCtx, {
    type: 'radar',
    data: {
        labels: {{ analytics.charts_data.quality_metrics.labels | tojsonfilter }},
        datasets: [{
            label: 'Quality Score',
            data: {{ analytics.charts_data.quality_metrics.data | tojsonfilter }},
            borderColor: '#00b894',
            backgroundColor: 'rgba(0, 184, 148, 0.2)',
            pointBackgroundColor: '#00b894'
        }]
    },
    options: {
        ...chartOptions,
        scales: {
            r: {
                beginAtZero: true,
                max: 100
            }
        }
    }
});

// Weekly Productivity Chart
const weeklyProductivityCtx = document.getElementById('weeklyProductivityChart').getContext('2d');
new Chart(weeklyProductivityCtx, {
    type: 'bar',
    data: {
        labels: {{ analytics.charts_data.daily_productivity.labels | tojsonfilter }},
        datasets: [{
            label: 'Productivity Score',
            data: {{ analytics.charts_data.daily_productivity.data | tojsonfilter }},
            backgroundColor: [
                '#667eea',
                '#764ba2',
                '#f093fb',
                '#4facfe',
                '#43e97b'
            ]
        }]
    },
    options: {
        ...chartOptions,
        scales: {
            y: {
                beginAtZero: true,
                max: 100
            }
        }
    }
});
</script>
{% endblock %}